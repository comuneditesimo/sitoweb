@page "/Admin/Canteen/Settings"

@layout MainLayout

@using ICWebApp.Components.Components.Homepage.Backend.Theme

<div class="element-separator"></div>
@if (Configuration != null)
{
    <div class="segment-container custom-background-default">
        <EditForm Model="@Configuration">
            <DataAnnotationsValidator/>
            <div class="form-group form-group-small">
                <div class="segment-title custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_BALANCE")</div>
            </div>
            <div class="extra-small-element-separator"></div>
            <div class="form-group form-group-small">
                <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_BALANCE_LOW_WARNING")</label>
                <TelerikNumericTextBox @bind-Value="Configuration.BalanceLowWarning" class="form-control" Format="C"></TelerikNumericTextBox>
            </div>
            <div class="extra-small-element-separator"></div>
            <div class="extra-small-element-separator"></div>
            <div class="form-group form-group-small">
                <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_NOTIFICATION_INTERVAL")</label>
                <InputNumber name="@Guid.NewGuid()" @bind-Value="Configuration.ReminderIntervallDays" class="form-control"></InputNumber>
            </div>
            <div class="extra-small-element-separator"></div>
            <div class="form-group form-group-small">
                <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_RECHARGE_MIN_AMOUNT")</label>
                <TelerikNumericTextBox @bind-Value="Configuration.RechargeMinAmount" class="form-control" Format="C"></TelerikNumericTextBox>
            </div>
            <div class="extra-small-element-separator"></div>
            <div class="form-group form-group-small">
                <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_ENABLE_SERVICE_STOP")</label>
                <TelerikSwitch @bind-Value="Configuration.ServiceStopEnabled"></TelerikSwitch>
            </div>
            @if (Configuration.ServiceStopEnabled)
            {
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_BALANCE_SERVICE_STOP")</label>
                    <TelerikNumericTextBox @bind-Value="Configuration.BalanceLowServiceStop" class="form-control" Format="C"></TelerikNumericTextBox>
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_ENABLE_DEREGISTRATIONS")</label>
                    <TelerikSwitch @bind-Value="Configuration.AllowCanteenDeregistrationIfServiceStopEnabled"></TelerikSwitch>
                </div>
                <div class="extra-small-element-separator"></div>
            }
            @if (Configuration.PosMode)
            {
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("CANTEEN_BACKEND_SETTING_POS_CARD_PRICE")</label>
                    <TelerikNumericTextBox @bind-Value="Configuration.NewPosCardPrice" class="form-control" Format="C"></TelerikNumericTextBox>
                </div>
            }
            @if (IsHomepage == true)
            {
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label">@TextProvider.Get("BACKEND_HOMEPAGE_THEMES")</label>
                    <ThemeSelection @bind-SelectedThemes="@SelectedThemes"></ThemeSelection>
                </div>
                <div class="extra-small-element-separator"></div>
                <LanguageInputSelector @bind-CurrentLanguage="@CurrentLanguage"></LanguageInputSelector>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("BACKEND_FORM_DEFINITION_FOR_WHOM")</label>
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    @if (Configuration.CANTEEN_Configuration_Extended != null && Configuration.CANTEEN_Configuration_Extended.Count() > 0 && CurrentLanguage != null)
                    {
                        @if (string.IsNullOrEmpty(Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).ForWhom))
                        {
                            Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).ForWhom = Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID != CurrentLanguage).ForWhom;
                        }

                        <TelerikEditor @bind-Value="Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).ForWhom"
                                       Tools="@Tools"
                                       EditMode="@EditorEditMode.Div"
                                       Class="font-normal"
                                       Height="250px">
                            <EditorSettings>
                                <EditorPasteSettings ConvertMsLists="true"
                                                     RemoveMsClasses="true"
                                                     RemoveMsStyles="true"
                                                     RemoveHtmlComments="true"
                                                     RemoveAllAttributes="true"
                                                     StripTags="@StripTags"
                                                     RemoveAttributes="@RemoveAttributes">
                                </EditorPasteSettings>
                            </EditorSettings>
                        </TelerikEditor>
                    }
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("BACKEND_FORM_DEFINITION_HOW_TO")</label>
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    @if (Configuration.CANTEEN_Configuration_Extended != null && Configuration.CANTEEN_Configuration_Extended.Count() > 0 && CurrentLanguage != null)
                    {
                        @if (string.IsNullOrEmpty(Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).HowTo))
                        {
                            Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).HowTo = Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID != CurrentLanguage).HowTo;
                        }

                        <TelerikEditor @bind-Value="Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).HowTo"
                                       Tools="@Tools"
                                       EditMode="@EditorEditMode.Div"
                                       Class="font-normal"
                                       Height="250px">
                            <EditorSettings>
                                <EditorPasteSettings ConvertMsLists="true"
                                                     RemoveMsClasses="true"
                                                     RemoveMsStyles="true"
                                                     RemoveHtmlComments="true"
                                                     RemoveAllAttributes="true"
                                                     StripTags="@StripTags"
                                                     RemoveAttributes="@RemoveAttributes">
                                </EditorPasteSettings>
                            </EditorSettings>
                        </TelerikEditor>
                    }
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("BACKEND_FORM_DEFINITION_WHATFOR")</label>
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    @if (Configuration.CANTEEN_Configuration_Extended != null && Configuration.CANTEEN_Configuration_Extended.Count() > 0 && CurrentLanguage != null)
                    {
                        @if (string.IsNullOrEmpty(Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).WhatFor))
                        {
                            Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).WhatFor = Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID != CurrentLanguage).WhatFor;
                        }

                        <TelerikEditor @bind-Value="Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).WhatFor"
                                       Tools="@Tools"
                                       EditMode="@EditorEditMode.Div"
                                       Class="font-normal"
                                       Height="250px">
                            <EditorSettings>
                                <EditorPasteSettings ConvertMsLists="true"
                                                     RemoveMsClasses="true"
                                                     RemoveMsStyles="true"
                                                     RemoveHtmlComments="true"
                                                     RemoveAllAttributes="true"
                                                     StripTags="@StripTags"
                                                     RemoveAttributes="@RemoveAttributes">
                                </EditorPasteSettings>
                            </EditorSettings>
                        </TelerikEditor>
                    }
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    <label class="form-label custom-color-primary">@TextProvider.Get("BACKEND_FORM_DEFINITION_RESULT")</label>
                </div>
                <div class="extra-small-element-separator"></div>
                <div class="form-group form-group-small">
                    @if (Configuration.CANTEEN_Configuration_Extended != null && Configuration.CANTEEN_Configuration_Extended.Count() > 0 && CurrentLanguage != null)
                    {
                        @if (string.IsNullOrEmpty(Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).Result))
                        {
                            Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).Result = Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID != CurrentLanguage).Result;
                        }

                        <TelerikEditor @bind-Value="Configuration.CANTEEN_Configuration_Extended.FirstOrDefault(p => p.LANG_Language_ID == CurrentLanguage).Result"
                                       Tools="@Tools"
                                       EditMode="@EditorEditMode.Div"
                                       Class="font-normal"
                                       Height="250px">
                            <EditorSettings>
                                <EditorPasteSettings ConvertMsLists="true"
                                                     RemoveMsClasses="true"
                                                     RemoveMsStyles="true"
                                                     RemoveHtmlComments="true"
                                                     RemoveAllAttributes="true"
                                                     StripTags="@StripTags"
                                                     RemoveAttributes="@RemoveAttributes">
                                </EditorPasteSettings>
                            </EditorSettings>
                        </TelerikEditor>
                    }
                </div>
            }
            <div class="segment-button-toolbar">
                <TelerikButton ButtonType="ButtonType.Button" ThemeColor="Primary" Icon="SvgIcon.ArrowRight" Class="k-standalone-button"
                               OnClick="@SaveConfig">
                    @TextProvider.Get("BUTTON_SAVE")
                </TelerikButton>
            </div>
        </EditForm>
    </div>
}